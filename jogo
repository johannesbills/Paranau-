from PPlay.window import *
from PPlay.sprite import *
from PPlay.gameimage import *
from luta_pa import *

def plataforma(janela):

    teclado = Window.get_keyboard()

    lista_guardas = []
    lista_plat = []

    player = Sprite("player.png")
    fundo = Sprite("foto1.png")
    guarda = Sprite("inimigo.png")
    plat = Sprite("plat2.png")
    grama = Sprite("grama.png")
    terra = Sprite("terra.png")
    base_plat = Sprite("platbase2.png")
    base_plat2 = Sprite("platbase2.png")
    base_plat3 = Sprite("platbase2.png")

    base_plat.set_position(0, janela.height - base_plat.height)
    base_plat2.set_position(base_plat.width, janela.height - base_plat2.height)
    base_plat3.set_position(janela.width - base_plat3.width, janela.height - base_plat3.height)
    plat.set_position(janela.width - base_plat3.width - 250, janela.height - base_plat3.height * 2 - plat.height)
    terra.set_position(janela.width - base_plat3.width - 250, janela.height - base_plat3.height * 2 - terra.height)
    grama.set_position(janela.width - base_plat3.width - 250, janela.height - base_plat3.height * 2 - terra.height - grama.height)
    player.set_position(0, janela.height - base_plat.height - player.height)
    guarda.set_position(janela.width/1.5 - 80, janela.height - base_plat3.height * 2 - grama.height - terra.height - guarda.height)
    
    lista_guardas.append(guarda)


    velplayerx = 100
    delaypulo = 0
    delayandar = 100
    x = 0
    subindo = 0
    y = janela.height - base_plat.height - player.height
    pulo = 0
    respirarinimigo = 0
    movimento = 0
    velplayery = 300
    gravidade = 110
    clone = player
    score = 0
    lifes = 3


    direita = Sprite("player.png")
    esquerda = Sprite("-player.png")
    while True:
        fundo.draw()
        if player.collided(base_plat) or player.collided(base_plat2) or player.collided(base_plat3) or player.collided(plat):
            if teclado.key_pressed("SPACE"):
                pulo = 1
            if teclado.key_pressed("D") or teclado.key_pressed("right"):
                player.x += velplayerx * janela.delta_time()
                x += velplayerx * janela.delta_time()
                clone = direita
                if movimento == 0:
                    player = Sprite("andar1.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 16:
                    player = Sprite("andar2.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 32:
                    player = Sprite("andar3.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 48:
                    player = Sprite("andar4.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 64:
                    player = Sprite("andar5.png")
                    movimento = 0
                    player.set_position(x, y)
            else:
                player = Sprite("player.png")
                player.set_position(x, y)

            if teclado.key_pressed("A") or teclado.key_pressed("left"):
                player.x -= velplayerx * janela.delta_time()
                x -= velplayerx * janela.delta_time()
                clone = esquerda
                if movimento <= 0:
                    player = Sprite("-andar1.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 16:
                    player = Sprite("-andar2.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 32:
                    player = Sprite("-andar3.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 48:
                    player = Sprite("-andar4.png")
                    movimento += 1
                    player.set_position(x, y)
                elif movimento <= 64:
                    player = Sprite("-andar5.png")
                    movimento = 0
                    player.set_position(x, y)
                if player.x < 0:
                    player.x = 0
        else:
            player.y += gravidade * janela.delta_time()
            y += gravidade * janela.delta_time()
        if pulo == 1:
            if subindo < 85:
                player.y -= velplayery * janela.delta_time()
                subindo += 1
                y -= velplayery * janela.delta_time()
                if clone == direita:
                    if movimento <= 0:
                        player = Sprite("pular1.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 32:
                        player = Sprite("pular2.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 64:
                        player = Sprite("pular3.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 96:
                        player = Sprite("pular4.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 128:
                        player = Sprite("pular5.png")
                        player.set_position(x, y)
                elif clone == esquerda:
                    if movimento <= 0:
                        player = Sprite("-pular1.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 32:
                        player = Sprite("-pular2.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 64:
                        player = Sprite("-pular3.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 96:
                        player = Sprite("-pular4.png")
                        movimento += 1
                        player.set_position(x, y)
                    elif movimento <= 128:
                        player = Sprite("-pular5.png")
                        player.set_position(x, y)
            else:
                movimento = 0
                pulo = 0
                subindo = 0
        if teclado.key_pressed("D") or teclado.key_pressed("right"):
            player.x += velplayerx * janela.delta_time()
            x += velplayerx * janela.delta_time()
        if teclado.key_pressed("A") or teclado.key_pressed("left"):
            player.x -= velplayerx * janela.delta_time()
            x -= velplayerx * janela.delta_time()
        
        if y > base_plat.y:
            y = janela.height - base_plat.height - player.height
        
        if respirarinimigo <= 0:
            guarda = Sprite("respirar inimigo.png")
            guarda.set_position(janela.width / 1.5 - 80, janela.height - base_plat3.height * 2 - grama.height - terra.height - guarda.height)
            respirarinimigo = 400
        elif respirarinimigo <= 200:
            guarda = Sprite("inimigo.png")
            guarda.set_position(janela.width / 1.5 - 80, janela.height - base_plat3.height * 2 - grama.height - terra.height - guarda.height)
            respirarinimigo -= 1
        else:
            respirarinimigo -= 1
        

        for guarda in lista_guardas:
            if guarda.x > player.x and guarda.x < player.x + guarda.height:
                if guarda.collided(player):
                    n_score = luta(janela, 1, score)
                    if n_score == score:
                        lifes -= 1
                        if lifes == 0:
                            game_over(janela,score)
                            return 0
                    else:
                        score = n_score
                    print(lista_guardas)
                    lista_guardas.pop(lista_guardas.index(guarda))

        base_plat2.draw()
        plat.draw()
        terra.draw()
        grama.draw()
        base_plat.draw()
        base_plat3.draw()

        for guarda in lista_guardas:
            guarda.draw()
        
        player.draw()
        janela.update()
